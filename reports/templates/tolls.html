{% extends 'base.html' %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<form action="/reports/tolls/" method="POST" onsubmit="return validate()" name="Select">{% csrf_token %}
    <h1>Toll Statements</h1>
    <p style='font-size:20px'>Billing period</p> 
        <select style='font-size:16px' type="select" name="bill_period" id="month" value="{{ i }}">
            <option value="%">--Select--</option>
            {% for i in periods %}
            <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
        </select>
        <p></p>
        <p></p>
    {% if depts %}
        <span style='font-size:20px'>Departments
            <select style='font-size:16px, width:50%' requried type="select" name="dept_id" id="html_test" value="{{ i }}" onchange="display_dept({{dept_names}})">
                <option></option>
                <!-- <option value="%">--Select--</option> -->
                {% for dept in depts %}
                <option value="{{ dept }}">{{ dept }}</option>
                {% endfor %}
        </select>
     </span>
     <span id="display"></span>
     <p></p>
     {% endif %}
    <p><input type='submit' value='Submit' class="btn btn-primary"></p>
</form>

{% if inactive %}
    <span style="color:red">{{dept_name}} ({{dept_id}})</span><i class="fas fa-exclamation-triangle" style="color:red"></i>
    <p></p>
    <p></p>
{% elif submit %}
    <h5>{{dept_name}} ({{dept_id}})</h5>
{% endif %}

{% if inactive %}
    <p>No reports created for inactive departments.</p>
{% elif submit %}
    <h5>{{bill_period}}</h5>
    <table class="table table-hover table-headings">
        <thead>
            <tr>
                    <th>CSV</th>
                    <th>PDF</th>
                    <th>Condensed PDF</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                {% comment %} have to put department on page when selection occurs  {% endcomment %}
                    <td> 
                        <a href='download/csv/{{bill_month}}_{{bill_year}}/{{dept_id}}/' download="{{bill_month}}{{bill_year}}-{{dept_id}}.csv"><i class="fas fa-file-csv" style="font-size:20px;color:green"></i></i> CSV Download</a></td>
                    <td> 
                        <a href='download/pdf/{{bill_month}}_{{bill_year}}/{{dept_id}}/'><i class="fa fa-file-pdf-o" style="font-size:20px;color:red"></i> PDF Download</a></td>
                    <td>
                        <a href='download/cond-pdf/{{bill_month}}_{{bill_year}}/{{dept_id}}/'><i class="fa fa-file-pdf-o" style="font-size:20px;color:red"></i> Condensed PDF Download</a></td>
            </tr>
        </tbody>
    </table>
{% endif %}

{% if inactive %}
    <i class="fas fa-exclamation-triangle" style="color:red"></i><span style="color:red">Department is inactive.</span>
{% endif %}

<script>
    function validate() {
        var bill_date = document.forms["Select"]["bill_period"];
        var deptid = document.forms["Select"]["dept_id"];

        if (bill_date.selectedIndex < 1) {
            window.alert("Please select a billing date.");
            bill_date.focus();
            return false;
        }
        if (deptid.selectedIndex < 1) {
            deptid.focus();
            window.alert("Please select a department.");
            return false;
        }
        return true;
    }

    function display_dept(depts) {
        var deptid = document.forms["Select"]["dept_id"];
        var index = deptid.selectedIndex - 1;
        document.getElementById("display").innerHTML = depts[index];
    }
</script>

{% endblock %}

{% block js %}
<script type="text/javascript" src="/static/select.js"></script>
{% endblock %}

{% extends 'base.html' %}
{% block content %}

<style>
	.table-total {
		background-color:#F0AD4E;
	}

	.total-col {
		text-align:right;
	}

	.submit-link {
		text-align:left;
		float:left;
	    background:none!important;
	    border:none; 
	    padding:0!important;
	    text-decoration:underline;
	    cursor:pointer;
	}

	#edit-selection {
		text-decoration:underline;
	}

</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="container">
	<button onclick="topFunction()" id="scrollTop" title="Go to top"><i class="fas fa-chevron-up"></i><br>Scroll to top</button>
		<strong class="d-inline">Your selection</strong>
		<div class="d-inline offset-md-2">
			<button class="btn btn-link d-inline" onclick="location.href='../..'"><i class="fas fa-edit"></i>Edit Your Selection</button>
		</div>

		<div class="row">
			<div class="card border-dark col-md-5">
				<div class="card-body" style="padding-bottom:0;">
					<div id="selected_dept"><strong>Department:&nbsp;&nbsp;</strong>{{ dept }}<br></div>
					<div id="billing_date"><strong>Billing Date:&nbsp;&nbsp;</strong>{{ billing_date }}<br></div>
					<strong style="float:left;">Chartfields:&nbsp;&nbsp;</strong>
					<p id="chartcoms" style="float:left;">
					{% for c in charge_types %}
						{{ c.account_number }}<br>
					{% endfor %}
					</p>
				</div>
			</div>
		</div>


		{% for c in charge_types %}
		{% if c.data %}
		<div class="row mt-5">
			<div class="card border-dark" style="width:83%;">
				<div class="card-header">
					<strong>Chartfield:</strong>&nbsp;{{ c.account_number }}
				</div>
				<div class="card-body">
					{% if c.type_summary %}
					<strong>Summary</strong>
					<table class="table table-sm">
						<thead>
							<tr class="table-secondary">
								<th scope="col">Type of Service</th>
								<th scope="col" class='total-col'>Total Charge</th>
							</tr>
						</thead>
						<tbody>
							{% for key, value in c.type_summary.items %}
								<tr>
									<td>{{ key }}</td>
									<td class='total-col'>{{ value }}</td>
								</tr>
							{% endfor %}
							<tr class='table-total'>
								<td><strong>Total</strong></td>
								<td class='total-col'>{{ c.type_total }}</td>
							</tr>
						</tbody>
					</table>
					{% endif %}

					{% for key, value in c.charge_tables.items %}
					<div class="mt-5">
						<strong>{{ key }} Charges</strong>
						<table class="table table-sm" id='charge_table'>
							<thead>
								<tr class="table-secondary">
									<th scope='col' style='text-align:left;'>Billing ID</th>
									<th scope="col">Monthly Charges</th>
									{% if title == 'Detail of Charges' %}
									<th scope="col" colspan='2'>Call Usage</th>
									{% endif %}
									<th scope="col" style='text-align:right;'>Total Charge</th>
								</tr>
							</thead>
							<tbody>
								{% if title == 'Detail of Charges' %}
								<tr class="table-warning">
									<td style='text-align:left;'></td>
									<td>Amount</td>
									<td>Number</td>
									<td>Amount</td>
									<td style='text-align:right;'>Amount</td>
								</tr>
								{% endif %}
								{% for v in value.rows %}
								<tr>
									<form method="POST" action='detail/' id="report_details">{% csrf_token %}
										<input type="hidden" name="selected_dept" value="{{ dept }}">
										<input type="hidden" name="billing_date" value="{{ billing_date }}">
										<input type="hidden" name="chartcoms" value="{{ chartfields }}">

										{% if title == 'Detail of Charges' %}
										<td><input class="btn btn-link submit-link" style="text-align:left;" type="submit" name="user_id" value="{{ v.user_defined_id }}"></td>
										{% else %}
										<td>{{ v.user_defined_id }}</td>
										{% endif %}
										<input type="hidden" name="sub_id:{{ v.user_defined_id}}" value="{{ v.subscriber_id }}">
										<input type="hidden" name="chartcom:{{ v.user_defined_id }}" value="{{ c.account_number }}">
										<input type="hidden" name="charge_type:{{ v.user_defined_id }}" value="{{ key }}">
										<td>{{ v.monthly_charges }}</td>
										{% if title == 'Detail of Charges' %}
										<td>{{ v.call_number }}</td>
										<td>{{ v.call_amount }}</td>
										{% endif %}
										<td style='text-align:right;'>{{ v.total_charges }}</td>
									</form>
								</tr>
								{% endfor %}
								<tr class='table-total'>
									<td style='text-align:left;'><strong>Total</strong></td>
									<td></td>
									{% if title == 'Detail of Charges' %}
									<td></td>
									<td></td>
									{% endif %}
									<td style='text-align:right;'>{{ value.total }}</td>
								</tr>
							</tbody>
						</table>
					</div>
					{% endfor %}

					{% if c.monthly_data %}
					<div class="mt-5">
						<strong>Monthly Service Charges</strong>
						<table class="table table-sm">
							<thead>
								<tr class="table-secondary">
									<th scope="col">Item Code</th>
									<th scope="col">Description</th>
									<th scope="col">Unit Amount</th>
									<th scope="col">Quantity</th>
									<th scope="col" class='total-col'>Total Charge</th>
								</tr>
							</thead>
							<tbody>
								{% for key, value in c.monthly_data.items %}
								<tr>
									<td>{{ key }}</td>
									<td>{{ value.desc }}</td>
									<td>{{ value.unit_amt }}</td>
									<td>{{ value.quantity }}</td>
									<td class='total-col'>{{ value.total }}</td>
								</tr>
								{% endfor %}
								<tr class='table-total'>
									<td><strong>Total</strong></td>
									<td></td>
									<td></td>
									<td></td>
									<td class='total-col'>{{ c.monthly_total }}</td>
								</tr>
							</tbody>
						</table>
					</div>
					{% endif %}

					{% if c.otc %}
					<div class="mt-5">
						<strong>One Time Charges</strong>
						<table class="table table-sm">
							<thead>
								<tr class="table-secondary">
									<th scope="col">Item Code</th>
									<th scope="col">Description</th>
									<th scope="col">Quantity</th>
									<th scope="col" style="text-align:right;">Total Amount</th>
								</tr>
							</thead>
							<tbody>
								{% for a in c.otc %}
								<tr>
									<td>{{ a.item_code }}</td>
									<td>{{ a.desc }}</td>
									<td>{{ a.qty }}</td>
									<td style="text-align:right;">{{ a.total }}</td>
								</tr>
								{% endfor %}
								<tr style="background-color:#F0AD4E;">
									<td><strong>Total</strong></td>
									<td></td>
									<td></td>
									<td style="text-align:right;">{{ c.otc_total }}</td>
								</tr>
							</tbody>
						</table>
					</div>
					{% endif %}

					{% if c.occ %}
					<div class="mt-5">
						<strong>Work Order Charges</strong>
						<table class="table table-sm">
							<thead>
								<tr class="table-secondary">
									<th scope="col">Work Order</th>
									<th scope="col">Service Order/Equipment</th>
									<th scope="col">Labor</th>
									<th scope="col" style="text-align:right">Total Charge</th>
								</tr>
							</thead>
							<tbody>
								{% for o in c.occ %}
								<tr>						
									<td>{{ o.work_order }}</td>
									<td>{{ o.equip }}</td>
									<td>{{ o.sol }}</td>
									<td style="text-align:right">{{ o.total_amt }}</td>
								</tr>
								{% endfor %}
								<tr style="background-color:#F0AD4E;">
									<td><strong>Total</strong></td>
									<td></td>
									<td></td>
									<td style="text-align:right">{{ c.occ_total }}</td>
								</tr>
							</tbody>
						</table>
					</div>
					{% endif %}

					{% if c.credits %}
					<div class="mt-5">
						<strong>Credits Summary</strong>
						<table class="table table-sm">
							<thead>
								<tr class="table-secondary">
									<th scope="col">Item Code</th>
									<th scope="col" style="text-align:right;">Credit</th>
								</tr>
							</thead>
							<tbody>
								{% for cr in c.credits %}
								<tr>
									<td>{{ cr.item_code }}</td>
									<td style="text-align:right;"> {{ cr.credit }}</td>
								</tr>
								{% endfor %}
								<tr style="background-color:#F0AD4E;">
									<td><strong>Total</strong></td>
									<td style="text-align:right;">{{ c.credit_total }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				    {% endif %}
				</div>
			</div>
		</div>
		{% else %}
		<div class="row mt-5">
			<div class="card border-dark" style="width:83%;">
				<div class="card-header">
					<strong>Chartfield:&nbsp;</strong>{{ c.account_number }}
				</div>
				<div class="card-body">
					<div class="col-md-9">
				        <div class="alert alert-danger col-md-9" role="alert">
				            <i class="fas fa-exclamation-triangle prv-msgs"></i>
				            This chartfield does not have any data this month.
				        </div>
				    </div>
				</div>
			</div>
		</div>
		{% endif %}
		{% endfor %}
</div>

{% endblock %}

{% block js %}

<script src="/../static/doc.js"></script> 

{% endblock %}
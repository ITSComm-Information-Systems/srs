{% extends 'base.html' %}
{% block content %}

<style>
	.table-total {
		background-color:#F0AD4E;
	}

	.total-col {
		text-align:right;
	}

	#submit-link {
		text-align:left;
		float:left;
	    background:none!important;
	    border:none; 
	    padding:0!important;
	    text-decoration:underline;
	    cursor:pointer;
	}

	#edit-selection {
		text-decoration:underline;
	}

</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="container">
	<button onclick="topFunction()" id="scrollTop" title="Go to top"><i class="fas fa-chevron-up"></i><br>Scroll to top</button>

	<form method="POST" action='detail/' id="report_details">{% csrf_token %}
		<div class="row-inline">
			<strong>Your selection</strong>
			<a class="offset-2 btn btn-link" id="edit-selection" href="..">Edit your selection</a>
		</div>

		<div class="row">
			<div class="card border-dark col-md-5">
				<div class="card-body">
					<div id="selected_dept"><strong>Department:&nbsp;&nbsp;</strong>{{ dept }}<br></div>
					<div id="billing_date"><strong>Billing Date:&nbsp;&nbsp;</strong>{{ billing_date }}<br></div>
					<strong style="float:left;">Chartfields:&nbsp;&nbsp;</strong>
					<p id="chartcoms" style="float:left;">
					{% for c in charge_types %}
						{{ c.account_number }}<br>
					{% endfor %}
					</p>
					<input type="hidden" name="selected_dept" value="{{ dept }}">
					<input type="hidden" name="billing_date" value="{{ billing_date }}">
					<input type="hidden" name="chartcoms" value="{{ chartfields }}">
				</div>
			</div>
		</div>


		{% for c in charge_types %}
		<div class="row mt-5">
			<strong>Chartfield:&nbsp;</strong>
			<p>{{ c.account_number }}</p>
		</div>

		{% if c.type_summary %}
		<div class="row">
			<div class="card border-dark col-md-10">
				<div class="card-body">
					<strong>Summary</strong>
					<table class="table table-sm mb-5">
						<thead>
							<tr class="table-secondary">
								<th scope="col">Type of Service</th>
								<th scope="col" class='total-col'>Total Charge</th>
							</tr>
						</thead>
						<tbody>
							{% for key, value in c.type_summary.items %}
								<tr>
									<td>{{ key }}</td>
									<td class='total-col'>{{ value }}</td>
								</tr>
							{% endfor %}
							<tr class='table-total'>
								<td><strong>Total</strong></td>
								<td class='total-col'>{{ c.type_total }}</td>
							</tr>
						</tbody>
					</table>

					{% for key, value in c.charge_tables.items %}
					<strong>{{ key }} Charges</strong>
					<table class="table table-sm mb-5" id='charge_table'>
						<thead>
							<tr class="table-secondary">
								<th scope='col' style='text-align:left;'>Billing ID</th>
								<th scope="col">Monthly Charges</th>
								<th scope="col" colspan='2'>Call Usage</th>
								<th scope="col" style='text-align:right;'>Total Charge</th>
							</tr>
						</thead>
						<tbody>
							<tr class="table-warning">
								<td style='text-align:left;'></td>
								<td>Amount</td>
								<td>Number</td>
								<td>Amount</td>
								<td style='text-align:right;'>Amount</td>
							</tr>
							{% for v in value.rows %}
							<tr>
								<td><input class="btn btn-link" style="text-align:left;" id="submit-link" type="submit" name="user_id" value="{{ v.user_defined_id }}"></td>
								<input type="hidden" name="sub_id:{{ v.user_defined_id}}" value="{{ v.subscriber_id }}">
								<input type="hidden" name="chartcom:{{ v.user_defined_id }}" value="{{ c.account_number }}">
								<input type="hidden" name="charge_type:{{ v.user_defined_id }}" value="IDK YET">
								<td>{{ v.monthly_charges }}</td>
								<td>{{ v.call_number }}</td>
								<td>{{ v.call_amount }}</td>
								<td style='text-align:right;'>{{ v.total_charges }}</td>
							</tr>
							{% endfor %}
							<tr class='table-total'>
								<td style='text-align:left;'><strong>Total</strong></td>
								<td></td>
								<td></td>
								<td></td>
								<td style='text-align:right;'>{{ value.total }}</td>
							</tr>
						</tbody>
					</table>
					{% endfor %}

					<strong>Monthly Service Charges</strong>
					{% if c.monthly_data %}
					<table class="table table-sm mb-5">
						<thead>
							<tr class="table-secondary">
								<th scope="col">Item Code</th>
								<th scope="col">Description</th>
								<th scope="col">Unit Amount</th>
								<th scope="col">Quantity</th>
								<th scope="col" class='total-col'>Total Charge</th>
							</tr>
						</thead>
						<tbody>
							{% for key, value in c.monthly_data.items %}
							<tr>
								<td>{{ key }}</td>
								<td>{{ value.desc }}</td>
								<td>{{ value.unit_amt }}</td>
								<td>{{ value.quantity }}</td>
								<td class='total-col'>{{ value.total }}</td>
							</tr>
							{% endfor %}
							<tr class='table-total'>
								<td><strong>Total</strong></td>
								<td></td>
								<td></td>
								<td></td>
								<td class='total-col'>{{ c.monthly_total }}</td>
							</tr>
						</tbody>
					</table>
					{% else %}
					<div class="col-md-9 mt-2">
				        <div class="alert alert-danger col-md-9" role="alert">
				            <i class="fas fa-exclamation-triangle" style="color:red"></i>
				            This chartfield does not have any monthly charges this month.
				        </div>
				    </div>
					{% endif %}

					<strong>One-Time Charges & Credits Summary</strong>
					{% if c.occ %}
					<table class="table table-sm">
						<thead>
							<tr class="table-secondary">
								<th scope="col">Work Order (if applicable)</th>
								<th scope="col">Description</th>
								<th scope="col" style="text-align:right">Total Amount</th>
							</tr>
						</thead>
						<tbody>
							{% for o in c.occ %}
							<tr>
								<td><a class="btn btn-link" style="text-decoration:underline;" href="tsr/">{{ o.work_order }}</a></td>
								<td>{{ o.desc }}</td>
								<td style="text-align:right">{{ o.total_amt }}</td>
							</tr>
							{% endfor %}
							<tr style="background-color:#F0AD4E;">
								<td><strong>Total</strong></td>
								<td></td>
								<td style="text-align:right">{{ c.occ_total }}</td>
							</tr>
						</tbody>
					</table>
					{% else %}
					<div class="col-md-9 mt-2">
				        <div class="alert alert-danger col-md-9" role="alert">
				            <i class="fas fa-exclamation-triangle" style="color:red"></i>
				            This chartfield does not have any one time charges this month.
				        </div>
				    </div>
					{% endif %}
				</div>
			</div>
		</div>
		{% else %}
		<div class="col-md-8">
	        <div class="alert alert-danger col-md-8" role="alert">
	            <i class="fas fa-exclamation-triangle" style="color:red"></i>
	            This chartfield does not have any data this month.
	        </div>
	    </div>
		{% endif %}
		{% endfor %}
	</form>
</div>

{% endblock %}

{% block js %}

<script src="/../static/doc.js"></script> 

{% endblock %}
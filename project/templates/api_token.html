<!DOCTYPE html>
<html>
  <head>      
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="robots" content="NONE,NOARCHIVE" />
      <title>Api Root â€“ Django REST framework</title>
          <link rel="stylesheet" type="text/css" href="/static/rest_framework/css/bootstrap.min.css"/>
          <link rel="stylesheet" type="text/css" href="/static/rest_framework/css/bootstrap-tweaks.css"/>
        
        <link rel="stylesheet" type="text/css" href="/static/rest_framework/css/prettify.css"/>
        <link rel="stylesheet" type="text/css" href="/static/rest_framework/css/default.css"/>

  </head>


  <body class="">

    <div class="wrapper">
      
        <div class="navbar navbar-static-top navbar-inverse"
             role="navigation" aria-label="navbar">
          <div class="container">
            <span>
              
                <a class='navbar-brand' rel="nofollow" href='https://www.django-rest-framework.org/'>
                    Django REST framework
                </a>
              
            </span>
            <ul class="nav navbar-nav pull-right">
              
                
                  <li class="navbar-text">{{ request.user.username }}</li>
                
              
            </ul>
          </div>
        </div>
      

        <div class="container">
        
        <ul class="breadcrumb">
            
              
                <li class="active"><a href="/api/">Api Root</a></li>
              
            
        </ul><br>
        </div>

        <div class="container">
        
            <h4>Use this page to request a token.</h4>

            Notes about API tokens:
            <ul>
                <li>The token will be linked to your user ID.</li>
                <li>The token can be regenerated at any time.</li>
                <li>If you are not an admin, you will have read-only access to the same instances (servers, volumes, etc.) that you can access in SRS.</li>
            </ul>

            <h4>Personal token.</h4>
            {% if token %}
                <table border="1" cellpadding="8" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Token</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                            <td>{{ token.user.username }}</td>
                            <td>
                                <span style="display:none" id="token-text-personal">{{ token.key }}</span>
                                <span>{{ token.key|slice:":4" }}****</span>
                                <button type="button" onclick="copyToClipboard('token-text-personal')">Copy</button>
                            </td>
                            <td>{{ token.created|date:"m-d-Y" }}</td>
                    </tbody>
                </table>

            {% else %}
                <b>No token found.</b>
            {% endif %}

            <p><br>
                Click below to replace token with a new one.
            </p>

            <form method="POST">{% csrf_token %}
                <input type="hidden" value="token">
                <button class="btn btn-primary js-tooltip" title="" data-original-title="Make a POST request on the Pool List resource">Request Token</button>
            </form>
            
            <h4>Group Token.</h4>
            {% if service_accounts %}
                <table border="1" cellpadding="8" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>MCommunity Group</th>
                            <th>Token</th>
                            <th>Created</th>
                            <th>Renew Token</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for service_account in service_accounts %}
                            <tr>
                                <td>{{ service_account.username }}</td>
                                <td>{{ service_account.email }}</td>
                                {% if service_account.auth_token.key %}
                                <td>
                                    <span style="display:none" id="token-text-{{ service_account.id }}">{{ service_account.auth_token.key }}</span>
                                    <span>{{ service_account.auth_token.key|slice:":4" }}****</span>
                                    <button type="button" onclick="copyToClipboard('token-text-{{ service_account.id }}')">Copy</button>
                                </td>
                                <td>{{ service_account.auth_token.created|date:"m-d-Y" }}</td>
                                <td>
                                    <form method="POST">{% csrf_token %}
                                        <input type="hidden" id="groupID" name="groupID" value="{{ service_account.id }}">
                                        <button class="btn btn-primary js-tooltip" title="" data-original-title="Make a POST request on the Pool List resource">Renew Token</button></button>
                                    </form>
                                </td>
                                {% else %}
                                <td></td><td></td>
                                <td>
                                    <form method="POST">{% csrf_token %}
                                        <input type="hidden" id="groupID" name="groupID" value="{{ service_account.id }}">
                                        <button class="btn btn-primary js-tooltip" title="" data-original-title="Make a POST request on the Pool List resource">Create Token</button>
                                    </form>
                                </td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            {% else %}
                <b>No token found.</b>
            {% endif %}            

        <hr>
                {% autoescape off %} {{ helppage.bodytext }} {% endautoescape %} 
        </div>


    </div>

    <script>
    function copyToClipboard(elementId) {
    const el = document.getElementById(elementId);
    const tokenText = (el?.innerText || el?.textContent || "").trim();

    if (!tokenText) {
        alert("No token found to copy");
        return;
    }

    navigator.clipboard.writeText(tokenText).then(
        () => alert("Token copied to clipboard"),
        (err) => alert("Failed to copy: " + err)
    );
    }
    </script>

</body>

</html>
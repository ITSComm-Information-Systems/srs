{% extends 'base.html' %}

{% block content %}

<form action="/orders/addtocart/" method="post" id="workflowForm" >
  {% csrf_token %}

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    {% for tab in tab_list %}
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" id="pills-{{ tab.step }}" href="#{{ tab.step }}" role="tab" aria-controls="pills-{{ tab.name }}" aria-selected="false">{{ tab }}</a>
      </li>
    {% endfor %}
  </ul>
  <div class="tab-content" id="pills-tabContent">
    {% for tab in tab_list %}
      <div class="tab-pane fade" id="{{ tab.step }}" role="tabpanel" aria-labelledby="pills-contact-tab">
        {% if tab.form.template %}
          {% include tab.form.template %}
        {% else %}
          <table>{{tab.form.as_table}}</table>
        {% endif %}
      </div>
    {% endfor %}

    <div style="overflow:auto;">
      <div style="float:right;">
        <button type="button" class="btn btn-primary" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
        <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextPrev(1)">Next</button>
      </div>
    </div>

  </div>


</form>

{% endblock %}

{% block js %}
<script>
currStep = 1;
lastStep = document.getElementsByClassName("tab-pane").length
$('#pills-tab li:first-child a').tab('show') // Select first tab

$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
  currStep = $(this)[0].id.substring(10,12) *1;
  console.log(lastStep)
  if (currStep == lastStep) {
    document.getElementById("nextBtn").innerHTML = "Add to Cart";
  }
})

function nextPrev(n) {
  currStep = currStep + n;
  $('#pills-tab li:nth-child(' + currStep + ') a').tab('show') ;

  if (currStep > lastStep) {
    document.getElementById("workflowForm").submit();
    return false;
  }
}

</script>
{% endblock %}